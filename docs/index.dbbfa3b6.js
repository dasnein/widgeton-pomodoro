(g=O||(O={})).Settings="settings",g.State="state",(l=_||(_={})).Timer="view-timer",l.Settings="view-settings",(c=p||(p={})).Start="button-start",c.Stop="button-stop",c.SettingsShow="button-settings-show",c.SettingsClose="button-settings-close",c.Reset="button-reset",(S=I||(I={})).TimeOperation="time-operation",S.TimeRemains="time-remains",S.HeaderRoundCurrent="header-round-current",S.HeaderRoundsTotal="header-rounds-total",(m=L||(L={})).Colored="timer-logo-colored",m.Colorless="timer-logo-colorless",(h=b||(b={})).LongBreak="audio-long-break",h.ShortBreak="audio-short-break",h.Work="audio-work",(E=B||(B={})).FocusPeriod="settings-value-focus-period",E.LongBreakPeriod="settings-value-long-break-period",E.Rounds="settings-value-rounds",E.ShortBreakPeriod="settings-value-short-break-period",(R=k||(k={})).FocusPeriod="settings-slider-focus-period",R.LongBreakPeriod="settings-slider-long-break-period",R.Rounds="settings-slider-rounds",R.ShortBreakPeriod="settings-slider-short-break-period";const t={RESET:document.getElementById("button-reset"),SETTINGS_CLOSE:document.getElementById("button-settings-close"),SETTINGS_SHOW:document.getElementById("button-settings-show"),START:document.getElementById("button-start"),STOP:document.getElementById("button-stop")},e={HEADER_ROUND_CURRENT:document.getElementById("header-round-current"),HEADER_ROUNDS_TOTAL:document.getElementById("header-rounds-total"),TIME_OPERATION:document.getElementById("time-operation"),TIME_REMAINS:document.getElementById("time-remains")},s={LOGO_COLORED:document.getElementById("timer-logo-colored"),LOGO_COLORLESS:document.getElementById("timer-logo-colorless")},n={LONG_BREAK:document.getElementById("audio-long-break"),SHORT_BREAK:document.getElementById("audio-short-break"),WORK:document.getElementById("audio-work")},i={SETTINGS:document.getElementById("view-settings"),TIMER:document.getElementById("view-timer")},o={FOCUS:document.getElementById("settings-value-focus-period"),LONG_BREAK:document.getElementById("settings-value-short-break-period"),ROUNDS:document.getElementById("settings-value-rounds"),SHORT_BREAK:document.getElementById("settings-value-long-break-period")},r={FOCUS:document.getElementById("settings-slider-focus-period"),LONG_BREAK:document.getElementById("settings-slider-short-break-period"),ROUNDS:document.getElementById("settings-slider-rounds"),SHORT_BREAK:document.getElementById("settings-slider-long-break-period")},d={focusPeriod:15e5,shortBreakPeriod:3e5,longBreakPeriod:9e5,rounds:4},a={round:0,running:!1,breakRunning:!1,timeLeft:15e5,showSettings:!1};(T=f||(f={})).Start="start",T.Stop="stop",T.NextRound="next-round",T.Reset="reset",T.SettingsShow="settings-show",T.SettingsClose="settings-close",T.SettingsUpdated="settings-updated",(N||(N={})).Hidden="hidden";const u=new class{constructor(){this._eventObject={},this._callbackId=0}dispatch(t,...e){let s=this._eventObject[t];if(!s)return console.warn(t+" not found!");for(let t in s)s[t](...e),"d"===t[0]&&delete s[t]}on(t,e){this._eventObject[t]||(this._eventObject[t]={});let s=this._callbackId++;return this._eventObject[t][s]=e,{unSubscribe:()=>{delete this._eventObject[t][s],0===Object.keys(this._eventObject[t]).length&&delete this._eventObject[t]}}}off(t){if(!t){this._eventObject={};return}delete this._eventObject[t]}};var g,l,c,S,m,h,E,R,T,O,_,p,I,L,b,B,k,f,N,v=()=>JSON.parse(localStorage.getItem(O.Settings)||"{}"),y=t=>localStorage.setItem(O.Settings,JSON.stringify(t)),A=()=>JSON.parse(localStorage.getItem(O.State)||"{}");const H=new class{constructor(){this._init()}_init(){this._loadSettings(),this._loadState()}_loadSettings(){let t=v();this._settings={...d,...t}}_loadState(){let t=A();this._state={...a,timeLeft:this._settings.focusPeriod,...t}}startTimer(){this._state.running=!0,this.state.round=this.state.round||1,this.reduceTimer()}stopTimer(){this._state.running=!1}reduceTimer(){if(this.state.round>0&&(this._state.timeLeft=this._state.timeLeft-1e3),this._state.timeLeft<0)return u.dispatch(f.NextRound);this._state.running&&setTimeout(this.reduceTimer.bind(this),1e3)}resetTimer(){this._init()}restartTimer(){this._loadState(),this.startTimer()}startBreak(){this._state.breakRunning=!0,this._state.timeLeft=this.state.round===this.settings.rounds?this.settings.longBreakPeriod:this.settings.shortBreakPeriod,this.reduceTimer()}startNextRound(){this._state.breakRunning=!1,this._state.round+=1,this._state.timeLeft=this.settings.focusPeriod,this.reduceTimer()}toggleSettings(t){this._state.showSettings=void 0===t?!this.state.showSettings:t}updateSettings(t){this._settings={...this.settings,...t}}get settings(){return this._settings}get state(){return this._state}},P={RELAX:"Отдыхаем",WORK:"Работаем"},w=t=>t.toString().padStart(2,"0"),D=(t,e)=>t&&(t.innerHTML=e.toString()),U=(t,e)=>t&&"value"in t&&(t.value=e.toString());function C(){H.state.running?(t.START?.classList.add(N.Hidden),t.STOP?.classList.remove(N.Hidden)):(t.START?.classList.remove(N.Hidden),t.STOP?.classList.add(N.Hidden)),function(){let t=H.state.breakRunning?P.RELAX:P.WORK,s=H.state.timeLeft,n=Math.floor(s/1e3/60),i=`${w(n)}:${w((s-6e4*n)/1e3)}`;e.TIME_OPERATION&&(e.TIME_OPERATION.innerHTML=t),e.TIME_REMAINS&&(e.TIME_REMAINS.innerHTML=i)}(),function(){let t=H.state.round===H.settings.rounds,e=H.state.breakRunning?t?H.settings.longBreakPeriod:H.settings.shortBreakPeriod:H.settings.focusPeriod,n=100-Math.floor(100*H.state.timeLeft/e);s.LOGO_COLORED&&(s.LOGO_COLORED.style.height=`${n}%`)}(),e.HEADER_ROUND_CURRENT&&(e.HEADER_ROUND_CURRENT.innerHTML=H.state.round.toString()),e.HEADER_ROUNDS_TOTAL&&(e.HEADER_ROUNDS_TOTAL.innerHTML=H.settings.rounds.toString()),H.state.running&&window.requestAnimationFrame(C)}const M="visible";function G(){H.state.showSettings?i.SETTINGS?.classList.add(M):i.SETTINGS?.classList.remove(M),D(o.ROUNDS,H.settings.rounds),U(r.ROUNDS,H.settings.rounds)}const K=t=>{t&&"play"in t&&"function"==typeof t.play&&t.play()},j={play(){H.state.breakRunning?H.state.round===H.settings.rounds?K(n.LONG_BREAK):K(n.SHORT_BREAK):K(n.WORK)}};t.START?.addEventListener("click",()=>{u.dispatch(f.Start)}),t.STOP?.addEventListener("click",()=>{u.dispatch(f.Stop)}),t.RESET?.addEventListener("click",()=>{u.dispatch(f.Reset)}),t.SETTINGS_SHOW?.addEventListener("click",()=>{u.dispatch(f.SettingsShow)}),t.SETTINGS_CLOSE?.addEventListener("click",()=>{u.dispatch(f.SettingsClose)}),r.ROUNDS?.addEventListener("input",t=>{let e=Number(t.target.value);H.updateSettings({rounds:e}),u.dispatch(f.SettingsUpdated)}),u.on(f.Start,function(){0===H.state.round&&j.play(),H.startTimer(),C()}),u.on(f.Stop,function(){H.stopTimer(),C()}),u.on(f.NextRound,function(){H.state.round>=H.settings.rounds&&H.state.breakRunning?H.restartTimer():H.state.breakRunning?H.startNextRound():H.startBreak(),j.play()}),u.on(f.Reset,function(){H.resetTimer(),C()}),u.on(f.SettingsShow,function(){H.toggleSettings(!0),G()}),u.on(f.SettingsClose,function(){H.toggleSettings(!1),G()}),u.on(f.SettingsUpdated,function(){y(H.settings),G()}),C(),G();
//# sourceMappingURL=index.dbbfa3b6.js.map
